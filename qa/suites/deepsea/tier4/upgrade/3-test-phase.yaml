tasks:
- exec:
        client.salt_master:
                - 'echo "Salt Master node, pre-upgrade"'
                - 'cat /etc/os-release'
- deepsea.install_migration_rpm:
- deepsea.repository:
        client.salt_master:
- deepsea.reboot:
        client.salt_master:
            tries: 90
- exec:
        client.salt_master:
                - 'echo "Salt Master node, post-upgrade"'
                - 'cat /etc/os-release'
                - 'cat /etc/issue'
                - 'cat /var/log/distro_migration.log || true'
                - 'zypper packages --orphaned'
                - 'deepsea --version || true'
                - 'salt-run deepsea.version 2>/dev/null || true'
- exec:
        mon.a:
                - 'ceph --version || true'
                - 'ceph -s || true'
- deepsea.toolbox:
        add_noout:
                osd.0:
- exec:
        osd.0:
                - 'ceph-volume simple scan --force'
- deepsea.repository:
        mon.a:
- deepsea.reboot:
        mon.a:
            tries: 90
- exec:
        mon.a:
                - 'ceph-volume simple activate --all'
- deepsea.toolbox:
        rm_noout:
                osd.0:
- exec:
        client.salt_master:
                - 'ceph --version || true'
                - 'ceph -s || true'
